{
  /* Default DevContainer configuration file demonstrates
    1. Uses pre-built container from Dockerhub (mathworks/matlab)
    2. Configured for following modes of access:
      a. MATLAB in a Browser
      b. Directly from VSCode, using the MATLAB extension for VSCode
      c. Using Jupyter Notebooks in VSCode
      d. Start Codespace in Jupyter
  */
  "name": "Based on DockerHub Image",
  // See https://hub.docker.com/r/mathworks/matlab/tags for available images.
  // NOTE to self:  Pulling from GHCR can be faster, do we want to pull from the matlab-dockerfile repo instead?
  "image": "mathworks/matlab:latest",
  "hostRequirements": {
    "cpus": 4
  },
  "portsAttributes": {
    "8888": {
      "label": "MATLAB",
      // "onAutoForward": "openBrowser"
      // "onAutoForward": "openBrowserOnce"
      "onAutoForward": "openPreview"
      // Open Preview Pros & Cons:
      // Pros: Embedded webview is nice for login purposes.
      // Cons: MATLAB does not render in the embedded view.
      // "onAutoForward": "notify"
    }
  },
  "waitFor": "updateContentCommand",
  "onCreateCommand": {
    // Installing GIT to support codespaces & devcontainer workflows
    "install-dependencies": "sudo apt-get update && sudo apt-get install --no-install-recommends -y git xvfb"
  },
  // Use PIPX to update the existing installation of matlab-proxy
  "updateContentCommand": "pipx upgrade matlab-proxy && pipx inject --include-apps --include-deps matlab-proxy jupyter-matlab-proxy jupyterlab",
  "postStartCommand": "env MWI_APP_PORT=8888 MWI_ENABLE_TOKEN_AUTH=False run.sh -browser",
  // Configure MATLAB's startup folder
  "containerEnv": {
    "MATLAB_USERWORKDIR": "${containerWorkspaceFolder}",
    "MATLAB_USE_USERWORK": "1",
    // "MWI_CUSTOM_HTTP_HEADERS": "{'Content-Security-Policy': 'frame-ancestors *'}",
    "MWI_CUSTOM_HTTP_HEADERS": "'{\"Content-Security-Policy\": \"frame-ancestors *\"}'"
  },
  // Configure VSCode Extensions
  "customizations": {
    "vscode": {
      "extensions": [
        "MathWorks.language-matlab",
        "ms-toolsai.jupyter",
        "ms-python.python"
      ],
      "settings": {
        "MATLAB.indexWorkspace": true,
        "MATLAB.matlabConnectionTiming": "onStart",
        "MATLAB.telemetry": true,
        "MATLAB.signIn": true,
        // Adds MATLAB's PIPX environments to Python indexer
        "python.venvPath": "/home/matlab/.local/pipx/venvs/",
        // Marks MATLAB Kernel as a trusted source
        "jupyter.kernels.trusted": [
          "/home/matlab/.local/pipx/venvs/matlab-proxy/share/jupyter/kernels/jupyter_matlab_kernel/kernel.json"
        ]
      }
    }
  }
}